pipeline{
    agent {
        docker { image 'hashicorp/middleman-hashicorp'}
        args
        }
    stages{
        stage('Setup'){
            steps{
                script{
                    dir ('external-docs'){
                        echo "External documentation work in progress"
                        sh "pwd"
                        sh "ls -la"
                    }
                }
            }
        }
        stage('Documentation'){
            steps{
                script{
                    dir ('external-docs'){
                        sh "bundle exec middleman server ./ \"setup*\" \"csvwlib/external-docs/my-project\""
                        sh 'bundle exec middleman build html docs docs/_build/html'
                        }
                    }
                    stash name: 'docs', includes: '**/docs/_build/html/**/*'
                }
            }
        }
    }