# SHACL Shapes

**N.B. SHACL Shapes are a work-in-progress.**

This directory contains a versioned history of the RDF shape of csvcubed's outputs.

The purpose of these SHACL shape definitions is to provide a well-defined and versioned description of the RDF which is 
produced by csvcubed. These definition specify the interface (or API) between csvcubed and applications which may wish to
process, consume or display the contents of CSV-Ws generated by the application. 

The SHACL shapes defined herein can also be used to check/validate whether a given CSV-W matches the csvcubed 
specifications. It is also possible to use [visualise]() these SHACL constraints to get an overview of the key 
RDF relationships. 

## Versioning

Versioning of csvcubed's outputs uses a `MAJOR.minor` approach to versioning. 

**Any changes to the RDF structure of said output files must be accompanied by a new version in this directory.**

### Major Versions

Major versions are for any and all breaking changes, including defining new triples which fundamentally change
how existing triples should be interpreted.

### Minor Versions

Minor versions may only **add** triple definitions which are **optional** and can safely be ignored by applications 
reading and interpreting CSV-Ws. 

## Folder Structure

Each major version should have a `v*` folder with folders for each minor version inside, e.g. for version `1.0`, 
the following folder structure exists:

```
v1      - MAJOR version
└── 0   - Minor version
    └── ...SHACL shape files...
```

### Files

Each version folder should: 

* Contain one JSON-LD file (at the top level) for each type of CSV-W output that csvcubed is capable of generating. 
  * For example a user should be able to locate the file defining a code-list's shape and validate their RDF directly against that.
* Any shared or extraneous files should be defined in a sub-directory so as not to clutter up the definitions.

## Visualisation

The SHACL shapes defined in turtle format can be visualised using the [SHACL Play!](https://shacl-play.sparna.fr/play/draw) tool.

## Validation

### Apache Jena

You can use the [Apache Jena shacl command](https://jena.apache.org/documentation/tools/#other-handy-command-line-tools) 
to validate SHACL shapes in turtle format against RDF data.


```bash
shacl validate --shapes shapes.ttl --data subsector.ttl
```

### pySHACL

[pySHACL](https://github.com/RDFLib/pySHACL) supports directly validating RDF against SON-LD definitions:

```bash
pyshacl -s code-list.json subsector.ttl --imports --metashacl 
```

N.B. The `imports` flag above is important when using the JSON-LD definitions since they are spread across multiple files.